<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Patients</title>
<link rel="icon" type="image/jpeg" href="logo.png">
<script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore-compat.js"></script>

<style>
body {
  font-family: "Segoe UI", Tahoma, sans-serif;
  background-color: #f4f6f8;
  margin: 0;
  padding: 40px 20px;
}

h1 {
  color: #0078d4;
  text-align: center;
  margin-bottom: 30px;
}

/* üîç Barre de recherche centr√©e */
.search-container {
  display: flex;
  justify-content: center;
  margin-bottom: 25px;
}

.search-container input {
  width: 60%;
  padding: 12px 18px;
  border-radius: 8px;
  border: 2px solid #0078d4;
  font-size: 16px;
  outline: none;
  transition: box-shadow 0.3s;
}
.search-container input:focus {
  box-shadow: 0 0 8px rgba(0,120,212,0.3);
}

/* üìã Liste des patients */
#listePatients {
  max-width: 700px;
  margin: auto;
  background: white;
  border-radius: 10px;
  box-shadow: 0 3px 8px rgba(0,0,0,0.1);
  padding: 0;
  overflow: hidden;
}

#listePatients li {
  list-style: none;
  padding: 15px 20px;
  border-bottom: 1px solid #eee;
  cursor: pointer;
  transition: background 0.2s;
}
#listePatients li:hover {
  background: #e9f3fc;
}
#listePatients li strong {
  color: #0078d4;
}

/* ü™ü Modale patient */
.modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.5);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 2000;
}



.modal h3 {
  color: #0078d4;
  margin-top: 0;
}
label {
  font-weight: 600;
  margin-top: 10px;
  display: block;
}
input, textarea, select {
  width: 100%;
  padding: 8px;
  border-radius: 6px;
  border: 1px solid #ccc;
  box-sizing: border-box;
}

/* üìú Historique d√©taill√© identique √† fiche.html */
#hospitalisationsContent {
  margin-top: 20px;
  display: flex;
  flex-direction: column;
  gap: 20px;
}
#hospitalisationsContent .card {
  background: #f9f9f9;
  padding: 20px;
  border-radius: 10px;
  box-shadow: 0 3px 8px rgba(0,0,0,0.15);
  border-left: 8px solid #0078d4;
}
#hospitalisationsContent h2 {
  color: #0078d4;
  border-bottom: 3px solid #0078d4;
  padding-bottom: 5px;
  margin-top: 0;
  margin-bottom: 15px;
}
#hospitalisationsContent h3 {
  color: #0078d4;
  margin-top: 10px;
  margin-bottom: 8px;
}
#hospitalisationsContent p {
  margin: 5px 0;
  line-height: 1.5;
  white-space: pre-wrap;
  color: #333;
}
#hospitalisationsContent .entry {
  border-left: 4px solid #0078d4;
  padding-left: 10px;
  margin-bottom: 10px;
  font-size: 14px;
}

button {
  all: unset;
  display: inline-block;
  padding: 10px 16px;
  border-radius: 8px;
  background-color: #0078d4;
  color: white;
  cursor: pointer;
  font-weight: 500;
  margin-top: 15px;
}
button:hover { background-color: #005ea2; }
button.secondary { background-color: #6c757d; }
button.secondary:hover { background-color: #5a6268; }


.modal {
  position: relative; /* permet de positionner les √©l√©ments internes */
  background: #fff;
  padding: 25px;
  border-radius: 12px;
  width: 90%;
  max-width: 900px;
  max-height: 90vh;
  overflow-y: auto;
  box-shadow: 0 4px 20px rgba(0,0,0,0.3);
}

/* ‚ùå Bouton de fermeture ‚Äî en haut √† droite */
.close-btn {
  position: absolute;
  top: 10px;
  right: 10px; /* ‚úÖ c‚Äôest cette ligne qui le met √† droite */
  left: auto !important; /* au cas o√π une r√®gle pr√©c√©dente l'aurait plac√© √† gauche */
  background: none;
  border: none;
  font-size: 22px;
  color: #666;
  cursor: pointer;
  transition: color 0.2s, transform 0.1s;
}
.close-btn:hover {
  color: #0078d4;
  transform: scale(1.2);
}

footer {
  margin-top: auto;
  padding: 15px;
  text-align: center;
  color: #777;
  font-size: 0.9rem;
}
.topbar {
  position: sticky;
  top: 0;
  z-index: 9999;
  background: #ffffff;
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 10px 16px;
  border-radius: 14px;
  box-shadow: 0 8px 24px rgba(0,0,0,0.12);
  margin-bottom: 15px;
}

.topbar-left {
  display: flex;
  align-items: center;
  gap: 20px;
}

.logo {
  font-weight: 700;
  font-size: 1.1rem;
  color: #005ea2;
}

.tabs {
  display: flex;
  gap: 8px;
}

.tab {
  background: transparent;
  color: #005ea2;
  border: none;
  padding: 8px 14px;
  border-radius: 8px;
  font-weight: 600;
  cursor: pointer;
}

.tab.active,
.tab:hover {
  background: #e6f0fc;
}

.topbar-right {
  display: flex;
  align-items: center;
  gap: 12px;
}

.icon-btn {
  background: #f0f4f8;
  color: #333;
  border: none;
  border-radius: 10px;
  padding: 8px 10px;
  font-size: 1.1rem;
  cursor: pointer;
}

.icon-btn:hover {
  background: #dbe9ff;
}

/* üîΩ Menu hover */
.hover-menu {
  position: relative;
}

.hover-panel {
  position: absolute;
  top: 120%;
  right: 0;
  background: white;
  border-radius: 10px;
  box-shadow: 0 12px 30px rgba(0,0,0,0.2);
  display: none;
  flex-direction: column;
  min-width: 180px;
  overflow: hidden;
}

.hover-panel button {
  background: none;
  border: none;
  padding: 10px 14px;
  text-align: left;
  cursor: pointer;
}

.hover-panel button:hover {
  background: #f0f8ff;
}

.hover-menu:hover .hover-panel {
  display: flex;
}
/* üîß Correctif lisibilit√© topbar */
.topbar button,
.topbar .tab,
.topbar .icon-btn {
  color: #1f2937; /* gris fonc√© lisible */
}
.hover-panel button {
  color: #1f2937;
  background: white;
}

.hover-panel button:hover {
  background: #e6f0fc;
  color: #005ea2;
}
.tab.active {
  background: #0078d4;
  color: white;
}
.menu-wrapper {
  position: relative;
}

.menu-panel {
  position: absolute;
  top: 120%;
  right: 0;
  background: white;
  border-radius: 10px;
  box-shadow: 0 12px 30px rgba(0,0,0,0.2);
  display: none;
  flex-direction: column;
  min-width: 180px;
  z-index: 9999;
  overflow: hidden;
}

.menu-panel button {
  background: none;
  border: none;
  padding: 10px 14px;
  text-align: left;
  cursor: pointer;
  color: #1f2937;
}

.menu-panel button:hover {
  background: #e6f0fc;
  color: #005ea2;
}

/* √©tat ouvert */
.menu-wrapper.open .menu-panel {
  display: flex;
}
.search-wrapper {
  position: relative;
}

.search-results {
  position: absolute;
  top: calc(100% + 6px);
  left: 0;
  width: 100%;
  max-height: 320px;
  overflow-y: auto;
  background: white;
  border-radius: 10px;
  box-shadow: 0 12px 30px rgba(0,0,0,0.25);
  z-index: 10000;
}

.search-results.hidden {
  display: none;
}

.resultat-item {
  padding: 10px 14px;
  cursor: pointer;
  border-bottom: 1px solid #eee;
}

.resultat-item:hover {
  background: #e6f0fc;
}

.topbar,
.search-container {
  position: relative;
}

 body  {
      font-family: 'Inter', sans-serif;
      margin: 0; padding: 20px;
      background: #f0f4f8;
      color: #222;
    }
</style>
</head>

<body>

<div id="mainContent">


 <input type="text" id="recherchePatient" placeholder="Recherche patient‚Ä¶">
      <div id="resultatsRecherchePrincipale" class="search-results hidden"></div>
<ul id="listePatients"></ul>


  </div>

<footer> ¬© 2025 ‚Äî GestUrg2 | Patients  </footer>
<script>
// === CONFIG FIREBASE ===
const firebaseConfig = {
  apiKey: "AIzaSyBKp5-7NNy0Gyl0tNbDgD-BxucYdg8ArWo",
  authDomain: "urgences-a8ed4.firebaseapp.com",
  projectId: "urgences-a8ed4",
  storageBucket: "urgences-a8ed4.appspot.com",
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// === VARIABLES ===
const liste = document.getElementById("listePatients");
const searchInput = document.getElementById("searchInput");
let patients = [];

// === CHARGEMENT ===
async function chargerPatients() {
  const snap = await db.collection("patients").orderBy("nom").get();
  patients = snap.docs.map(d => ({ id: d.id, ...d.data() }));
  afficherPatients(patients);
}

function afficherPatients(data) {
  liste.innerHTML = "";
  if (data.length === 0) {
    liste.innerHTML = "<li>Aucun patient trouv√©.</li>";
    return;
  }
 data.forEach(p => {
  const li = document.createElement("li");

  li.innerHTML = `
    <strong>${p.nom || "?"} ${p.prenom || ""}</strong><br>
    Sexe : ${p.sexe || "-"} &nbsp; | &nbsp; üìÖ ${p.dateNaissance || "?"}
  `;

  li.ondblclick = () => {
  window.parent.postMessage(
    {
      type: "OPEN_TAB",
      title: `Fiche Patient ${p.nom} ${p.prenom}`,
      url: `fiche-patient.html?id=${p.id}&from=urgences`
    },
    "*"
  );
}; 

  liste.appendChild(li);
});

}


recherchePatient.addEventListener("input", e => {
  const val = e.target.value.toLowerCase();

  const resultats = patients.filter(p => {
    // Normalisation de la date de naissance : jj/mm/aaaa
    let dateFormatee = "";
    if (p.dateNaissance) {
      const d = new Date(p.dateNaissance);
      if (!isNaN(d)) {
        const jour = String(d.getDate()).padStart(2, "0");
        const mois = String(d.getMonth() + 1).padStart(2, "0");
        const annee = d.getFullYear();
        dateFormatee = `${jour}/${mois}/${annee}`;
      } else {
        dateFormatee = p.dateNaissance; // si pas une date valide
      }
    }

    return (
      (p.nom && p.nom.toLowerCase().includes(val)) ||
      (p.prenom && p.prenom.toLowerCase().includes(val)) ||
      (p.id && p.id.toLowerCase().includes(val)) ||
      (dateFormatee && dateFormatee.includes(val)) // comparaison avec date normalis√©e
    );
  });

  afficherPatients(resultats);
});
document.querySelectorAll(".menu-toggle").forEach(btn => {
  btn.addEventListener("click", e => {
    e.stopPropagation();
    btn.parentElement.classList.toggle("open");
  });
});

document.addEventListener("click", () => {
  document.querySelectorAll(".menu-wrapper").forEach(m => m.classList.remove("open"));
});

// Init
chargerPatients();
</script>
</body>
</html>
